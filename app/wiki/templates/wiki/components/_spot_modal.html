<div class="relative z-10"
     aria-labelledby="modal-title"
     role="dialog"
     aria-modal="true"
     x-data="{currentStep: 1}">
    <!--
    Background backdrop, show/hide based on modal state.

    Entering: "ease-out duration-300"
      From: "opacity-0"
      To: "opacity-100"
    Leaving: "ease-in duration-200"
      From: "opacity-100"
      To: "opacity-0"
  -->
    <div class="fixed inset-0 bg-azure-100 backdrop-blur-sm bg-opacity-75 transition-opacity"></div>
    <div class="fixed inset-0 z-10 w-screen overflow-y-auto font-lato">
        <div class="flex flex-col min-h-full items-center justify-end p-4 gap-2 text-center sm:justify-center sm:p-0 w-full">
            <!--
        Modal panel, show/hide based on modal state.

        Entering: "ease-out duration-300"
          From: "opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95"
          To: "opacity-100 translate-y-0 sm:scale-100"
        Leaving: "ease-in duration-200"
          From: "opacity-100 translate-y-0 sm:scale-100"
          To: "opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95"
      -->
            <div class="relative transform overflow-hidden max-w-full sm:my-8 sm:w-full sm:max-w-lg sm:p-6 rounded-lg bg-white px-4 pb-4 pt-5 text-left shadow-xl transition-all flex flex-col gap-2 sm:gap-4">
                <!-- TODO: create close button and click away -->
                <header class="flex justify-between w-full">
                    <h3 class="text-xl font-bold leading-6 text-gray-900 text-left"
                        id="modal-title">
                        {% if spot.nickname %}
                            Spot: {{ spot.nickname }}
                        {% else %}
                            Spot: {{
                            spot.order }}
                        {% endif %}
                    </h3>
                    <a href="{% url 'piece_detail' spot.piece.pk %}"
                       class="justify-self-end text-rose-500 hover:text-rose-300">
                        <svg xmlns="http://www.w3.org/2000/svg"
                             fill="none"
                             viewBox="0 0 24 24"
                             stroke-width="1.5"
                             stroke="currentColor"
                             class="w-6 h-6">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M9.75 9.75l4.5 4.5m0-4.5l-4.5 4.5M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                        </svg>
                    </a>
                </header>
                <p class="mt-1">{{ spot.description }}</p>
                {% if spot.measures %}<p class="mt-1">{{ spot.measures }}</p>{% endif %}
                {% if spot.abc_notation %}
                    {% include "wiki/components/_abcjs_viewer.html" with viewer_id=spot_notes_id notes=spot.abc_notation %}
                {% endif %}
                <!-- TODO: add abcjs component -->
                {% if spot.recording %}
                    <div class="text-xl text-black font-bold flex gap-2 justify-start sm:items-center flex-col sm:flex-row">
                        Listen:
                        <audio controls class="max-w-full">
                            <source src="{{ spot.recording.file.url }}" type="audio/mpeg" />
                        </audio>
                    </div>
                {% endif %}
                {% if spot.skills %}
                    <div class="flex gap-2">
                        <h4 class="text-lg">Skills</h4>
                        <ul class="flex gap-2 flex-wrap">
                            {% for skill in spot.skills.all %}
                                <li class="text-sm rounded border border-pink-500 bg-pink-200 shadow-lg hover:border-pink-300 hover:bg-pink-100 hover:text-slate-800">
                                    <a href="{{ skill.get_absolute_url }}" class="block p-0.5">{{ skill.name }}</a>
                                </li>
                            {% endfor %}
                        </ul>
                    </div>
                {% endif %}
            </div>
            {% for step in spot.steps.all %}
                <div class="relative transform overflow-hidden max-w-full sm:my-8 sm:w-full sm:max-w-lg sm:p-6 rounded-lg bg-white px-4 pb-4 pt-5 text-left shadow-xl transition-all flex flex-col gap-2 sm:gap-4"
                     x-show="currentStep === {{ step.order }}"
                     x-cloak>
                    <h3 class="text-xl font-bold leading-6 text-gray-900 text-center">Step {{ step.order }}</h3>
                    <p class="mt-1">{{ step.instructions }}</p>
                    {% if step.recording %}
                        <div class="text-xl text-black font-bold flex gap-2 justify-start sm:items-center flex-col sm:flex-row">
                            Listen:
                            <audio controls class="max-w-full">
                                <source src="{{ step.recording.file.url }}" type="audio/mpeg" />
                            </audio>
                        </div>
                    {% endif %}
                    <div class="max-w-full overflow-scroll">
                        {% if step.abc_notation %}
                            {% include "wiki/components/_abcjs_viewer.html" with viewer_id=step.notes_id notes=step.abc_notation %}
                        {% endif %}
                    </div>
                    <div class="flex w-full justify-between">
                        <button class="{% if forloop.first %}bg-slate-500 pointer-events-none{% else %}bg-azure-500 hover:bg-azure-700{% endif %} text-white font-bold py-2 px-6 rounded"
                                {% if forloop.first %}disabled{% endif %}
                                type="button"
                                @click="currentStep--">Previous</button>
                        <button class="{% if forloop.last %}bg-slate-500 pointer-events-none{% else %}bg-azure-500 hover:bg-azure-700{% endif %} text-white font-bold py-2 px-4 rounded"
                                {% if forloop.last %}disabled{% endif %}
                                type="button"
                                @click="currentStep++">Next</button>
                    </div>
                </div>
            {% endfor %}
        </div>
    </div>
</div>
